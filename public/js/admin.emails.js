webpackJsonp([0],{

/***/ 0:
/***/ function(module, exports, __webpack_require__) {

	"use strict";
	
	var React = __webpack_require__(11);
	
	var _ = __webpack_require__(218);
	
	var UsersPage = __webpack_require__(223);
	var SendPage = __webpack_require__(224);
	
	var App = React.createClass({
	  displayName: "App",
	
	  getInitialState: function getInitialState() {
	    return {
	      users: [],
	      template: "" };
	  },
	  addUser: function addUser(user) {
	    var existing = _.find(this.state.users, function (u) {
	      return u._id === user._id;
	    });
	
	    if (!existing) {
	      this.setState({
	        users: this.state.users.concat([user])
	      });
	    }
	  },
	  removeUser: function removeUser(userOrId) {
	    if (userOrId._id) {
	      userOrId = userOrId._id;
	    }
	
	    var newUsers = this.state.users.filter(function (u) {
	      return u._id !== userOrId;
	    });
	
	    this.setState({
	      users: newUsers
	    });
	  },
	  clearUsers: function clearUsers() {
	    this.setState({
	      users: []
	    });
	  },
	  render: function render() {
	    return React.createElement(
	      "div",
	      { className: "row page-emails" },
	      React.createElement(
	        "div",
	        { className: "col s12" },
	        React.createElement(
	          "ul",
	          { className: "tabs" },
	          React.createElement(
	            "li",
	            { className: "tab col s3" },
	            React.createElement(
	              "a",
	              { className: "active", href: "#users" },
	              React.createElement(
	                "span",
	                { "class": "badge" },
	                "1."
	              ),
	              " Select users"
	            )
	          ),
	          React.createElement(
	            "li",
	            { className: "tab col s3" },
	            React.createElement(
	              "a",
	              { href: "#send" },
	              React.createElement(
	                "span",
	                { "class": "badge" },
	                "2."
	              ),
	              " Send"
	            )
	          )
	        )
	      ),
	      React.createElement(
	        "section",
	        { className: "tab-content" },
	        React.createElement(
	          "div",
	          { id: "users", className: "col s12" },
	          React.createElement(UsersPage, {
	            users: this.state.users,
	            addUser: this.addUser,
	            removeUser: this.removeUser,
	            clearUsers: this.clearUsers })
	        ),
	        React.createElement(
	          "div",
	          { id: "send", className: "col s12" },
	          React.createElement(SendPage, {
	            users: this.state.users })
	        )
	      )
	    );
	  }
	});
	
	React.render(React.createElement(App, null), document.getElementById("react-root"));

/***/ },

/***/ 223:
/***/ function(module, exports, __webpack_require__) {

	"use strict";
	
	var React = __webpack_require__(11);
	
	var Button = __webpack_require__(208);
	var ModelTable = __webpack_require__(217);
	
	module.exports = React.createClass({
	  displayName: "exports",
	
	  propTypes: {
	    users: React.PropTypes.array,
	    addUser: React.PropTypes.func },
	
	  getDefaultProps: function getDefaultProps() {
	    return {
	      users: [],
	      addUser: null };
	  },
	
	  onRowClick: function onRowClick(user) {
	    this.props.addUser(user);
	  },
	
	  render: function render() {
	    var self = this;
	
	    var columns = [{
	      name: "username"
	    }];
	
	    var users = React.createElement(
	      "em",
	      null,
	      "None selected"
	    );
	
	    if (this.props.users.length) {
	      users = this.props.users.map(function (user) {
	        return React.createElement(
	          "li",
	          { className: "collection-item" },
	          user.username,
	          React.createElement(
	            "a",
	            { href: "#!", className: "secondary-content",
	              "data-id": user._id, onClick: self._onRemoveUser },
	            React.createElement("i", { className: "fa fa-remove" })
	          )
	        );
	      });
	
	      users = React.createElement(
	        "div",
	        null,
	        React.createElement(Button, { label: "Clear all", size: "small", onClick: this._onClear }),
	        React.createElement(
	          "ul",
	          { className: "collection" },
	          users
	        )
	      );
	    }
	
	    return React.createElement(
	      "div",
	      { className: "row" },
	      React.createElement(
	        "div",
	        { className: "col s12 m5" },
	        React.createElement(ModelTable, {
	          modelName: "User",
	          columns: columns,
	          excludeRows: this.props.users,
	          onRowClick: this.onRowClick })
	      ),
	      React.createElement(
	        "div",
	        { className: "col s12 m6 offset-m1 selected-users" },
	        React.createElement(
	          "h2",
	          null,
	          "Selected users:"
	        ),
	        users
	      )
	    );
	  },
	
	  _onRemoveUser: function _onRemoveUser(e) {
	    e.preventDefault();
	
	    this.props.removeUser(e.currentTarget.dataset.id);
	  },
	
	  _onClear: function _onClear() {
	    this.props.clearUsers();
	  } });

/***/ },

/***/ 224:
/***/ function(module, exports, __webpack_require__) {

	"use strict";
	
	var React = __webpack_require__(11);
	
	var Timer = __webpack_require__(1).Timer;
	
	var RenderUtils = __webpack_require__(213),
	    GuardedStateMixin = __webpack_require__(214);
	
	var Button = __webpack_require__(208),
	    Loader = __webpack_require__(212),
	    TextEditor = __webpack_require__(222);
	
	module.exports = React.createClass({
	  displayName: "exports",
	
	  mixins: [GuardedStateMixin],
	
	  getInitialState: function getInitialState() {
	    return {
	      template: "",
	      rendered: "",
	      loading: false,
	      error: null };
	  },
	
	  propTypes: {
	    users: React.PropTypes.array },
	
	  getDefaultProps: function getDefaultProps() {
	    return {
	      users: [] };
	  },
	
	  render: function render() {
	    var numUsers = this.props.users.length;
	
	    if (!numUsers) {
	      return React.createElement(
	        "em",
	        null,
	        "Please select some users to send to."
	      );
	    }
	
	    var sendBtnLabel = "Send to " + numUsers + " " + (1 == numUsers ? "user" : "users");
	
	    var bracketsSyntax = "{{...}}";
	
	    var tips = React.createElement(
	      "p",
	      { className: "tips" },
	      "NOTE: All app-level locals as well as ",
	      React.createElement(
	        "code",
	        null,
	        "recipient"
	      ),
	      " are available as template variables. Use ",
	      React.createElement(
	        "code",
	        null,
	        bracketsSyntax
	      ),
	      " syntax to insert."
	    );
	
	    var loadingAnim = null;
	
	    if (this.state.loading) {
	      loadingAnim = React.createElement(Loader, { size: "small", inline: true });
	    }
	
	    return React.createElement(
	      "div",
	      { className: "content-send" },
	      tips,
	      React.createElement(
	        "div",
	        { className: "row" },
	        React.createElement(
	          "div",
	          { className: "col m6 s12" },
	          React.createElement(
	            "h2",
	            null,
	            "Markdown"
	          ),
	          React.createElement(TextEditor, { height: "400px", onChange: this._onTemplateUpdate })
	        ),
	        React.createElement(
	          "div",
	          { className: "col m6 m-offset1 s12" },
	          React.createElement(
	            "h2",
	            null,
	            React.createElement(
	              "span",
	              null,
	              "Preview"
	            ),
	            loadingAnim
	          ),
	          RenderUtils.buildError(this.state.error),
	          React.createElement("div", { className: "preview",
	            dangerouslySetInnerHTML: { __html: this.state.rendered } })
	        )
	      ),
	      React.createElement(Button, { label: sendBtnLabel })
	    );
	  },
	
	  _onTemplateUpdate: function _onTemplateUpdate(text) {
	    this.setState({
	      template: text
	    });
	
	    this._fetchPreview();
	  },
	
	  _fetchPreview: function _fetchPreview() {
	    var self = this;
	
	    // if not users don't fetch
	    if (!this.props.users.length) {
	      return;
	    }
	
	    // give time for multiple successive template changes to take place
	    if (self._fetchPreviewTimer) {
	      self._fetchPreviewTimer.stop();
	    }
	
	    self._fetchPreviewTimer = Timer(function () {
	
	      self.setState({
	        loading: true,
	        error: null });
	
	      // fetch collection rows
	      $.ajax({
	        url: "/admin/emails/render?format=json",
	        method: "POST",
	        data: {
	          template: self.state.template,
	          user: self.props.users[0]._id
	        }
	      }).done(function (data) {
	        self.setStateIfMounted({
	          rendered: data.html });
	      }).fail(function (xhr) {
	        self.setStateIfMounted({
	          error: xhr
	        });
	      }).always(function () {
	        self.setStateIfMounted({
	          loading: false });
	      });
	    }, 300).start();
	  } });

/***/ }

});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wYWdlcy9lbWFpbHMvYXBwLmpzIiwid2VicGFjazovLy8uL3BhZ2VzL2VtYWlscy91c2Vycy5qcyIsIndlYnBhY2s6Ly8vLi9wYWdlcy9lbWFpbHMvc2VuZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLGFBQVksQ0FBQzs7QUFFYixLQUFJLEtBQUssR0FBRyxtQkFBTyxDQUFDLEVBQU8sQ0FBQyxDQUFDOztBQUU3QixLQUFJLENBQUMsR0FBRyxtQkFBTyxDQUFDLEdBQW9CLENBQUMsQ0FBQzs7QUFFdEMsS0FBSSxTQUFTLEdBQUcsbUJBQU8sQ0FBQyxHQUFTLENBQUMsQ0FBQztBQUNuQyxLQUFJLFFBQVEsR0FBRyxtQkFBTyxDQUFDLEdBQVEsQ0FBQyxDQUFDOztBQUVqQyxLQUFJLEdBQUcsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDO0FBQzVCLEdBQUUsV0FBVyxFQUFFLEtBQUs7O0dBRWxCLGVBQWUsRUFBRSxTQUFTLGVBQWUsR0FBRztLQUMxQyxPQUFPO09BQ0wsS0FBSyxFQUFFLEVBQUU7T0FDVCxRQUFRLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDbEI7R0FDRCxPQUFPLEVBQUUsU0FBUyxPQUFPLENBQUMsSUFBSSxFQUFFO0tBQzlCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLEVBQUU7T0FDbkQsT0FBTyxDQUFDLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUM7QUFDaEMsTUFBSyxDQUFDLENBQUM7O0tBRUgsSUFBSSxDQUFDLFFBQVEsRUFBRTtPQUNiLElBQUksQ0FBQyxRQUFRLENBQUM7U0FDWixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDO01BQ0o7SUFDRjtHQUNELFVBQVUsRUFBRSxT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QUcsRUFBRTtTQUNyQixJQUFJLENBQUMsaUJBQWlCLENBQUM7V0FDckIsS0FBSyxFQUFFLEdBQUc7VUFDWCxDQUFDLENBQUM7UUFDSixDQUFDLENBQUMsTUFBTSxDQUFDLFlBQVk7U0FDcEIsSUFBSSxDQUFDLGlCQUFpQixDQUFDO1dBQ3JCLE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ3JCLENBQUMsQ0FBQztNQUNKLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDakIsRUFBRSxDQUFDLEMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xuXG52YXIgXyA9IHJlcXVpcmUoXCIuLi8uLi91dGlscy9sb2Rhc2hcIik7XG5cbnZhciBVc2Vyc1BhZ2UgPSByZXF1aXJlKFwiLi91c2Vyc1wiKTtcbnZhciBTZW5kUGFnZSA9IHJlcXVpcmUoXCIuL3NlbmRcIik7XG5cbnZhciBBcHAgPSBSZWFjdC5jcmVhdGVDbGFzcyh7XG4gIGRpc3BsYXlOYW1lOiBcIkFwcFwiLFxuXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyczogW10sXG4gICAgICB0ZW1wbGF0ZTogXCJcIiB9O1xuICB9LFxuICBhZGRVc2VyOiBmdW5jdGlvbiBhZGRVc2VyKHVzZXIpIHtcbiAgICB2YXIgZXhpc3RpbmcgPSBfLmZpbmQodGhpcy5zdGF0ZS51c2VycywgZnVuY3Rpb24gKHUpIHtcbiAgICAgIHJldHVybiB1Ll9pZCA9PT0gdXNlci5faWQ7XG4gICAgfSk7XG5cbiAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgdXNlcnM6IHRoaXMuc3RhdGUudXNlcnMuY29uY2F0KFt1c2VyXSlcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgcmVtb3ZlVXNlcjogZnVuY3Rpb24gcmVtb3ZlVXNlcih1c2VyT3JJZCkge1xuICAgIGlmICh1c2VyT3JJZC5faWQpIHtcbiAgICAgIHVzZXJPcklkID0gdXNlck9ySWQuX2lkO1xuICAgIH1cblxuICAgIHZhciBuZXdVc2VycyA9IHRoaXMuc3RhdGUudXNlcnMuZmlsdGVyKGZ1bmN0aW9uICh1KSB7XG4gICAgICByZXR1cm4gdS5faWQgIT09IHVzZXJPcklkO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICB1c2VyczogbmV3VXNlcnNcbiAgICB9KTtcbiAgfSxcbiAgY2xlYXJVc2VyczogZnVuY3Rpb24gY2xlYXJVc2VycygpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHVzZXJzOiBbXVxuICAgIH0pO1xuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgIFwiZGl2XCIsXG4gICAgICB7IGNsYXNzTmFtZTogXCJyb3cgcGFnZS1lbWFpbHNcIiB9LFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJkaXZcIixcbiAgICAgICAgeyBjbGFzc05hbWU6IFwiY29sIHMxMlwiIH0sXG4gICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgXCJ1bFwiLFxuICAgICAgICAgIHsgY2xhc3NOYW1lOiBcInRhYnNcIiB9LFxuICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBcImxpXCIsXG4gICAgICAgICAgICB7IGNsYXNzTmFtZTogXCJ0YWIgY29sIHMzXCIgfSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgIFwiYVwiLFxuICAgICAgICAgICAgICB7IGNsYXNzTmFtZTogXCJhY3RpdmVcIiwgaHJlZjogXCIjdXNlcnNcIiB9LFxuICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIFwic3BhblwiLFxuICAgICAgICAgICAgICAgIHsgXCJjbGFzc1wiOiBcImJhZGdlXCIgfSxcbiAgICAgICAgICAgICAgICBcIjEuXCJcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgXCIgU2VsZWN0IHVzZXJzXCJcbiAgICAgICAgICAgIClcbiAgICAgICAgICApLFxuICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBcImxpXCIsXG4gICAgICAgICAgICB7IGNsYXNzTmFtZTogXCJ0YWIgY29sIHMzXCIgfSxcbiAgICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICAgIFwiYVwiLFxuICAgICAgICAgICAgICB7IGhyZWY6IFwiI3NlbmRcIiB9LFxuICAgICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICAgIFwic3BhblwiLFxuICAgICAgICAgICAgICAgIHsgXCJjbGFzc1wiOiBcImJhZGdlXCIgfSxcbiAgICAgICAgICAgICAgICBcIjIuXCJcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgXCIgU2VuZFwiXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJzZWN0aW9uXCIsXG4gICAgICAgIHsgY2xhc3NOYW1lOiBcInRhYi1jb250ZW50XCIgfSxcbiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICBcImRpdlwiLFxuICAgICAgICAgIHsgaWQ6IFwidXNlcnNcIiwgY2xhc3NOYW1lOiBcImNvbCBzMTJcIiB9LFxuICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoVXNlcnNQYWdlLCB7XG4gICAgICAgICAgICB1c2VyczogdGhpcy5zdGF0ZS51c2VycyxcbiAgICAgICAgICAgIGFkZFVzZXI6IHRoaXMuYWRkVXNlcixcbiAgICAgICAgICAgIHJlbW92ZVVzZXI6IHRoaXMucmVtb3ZlVXNlcixcbiAgICAgICAgICAgIGNsZWFyVXNlcnM6IHRoaXMuY2xlYXJVc2VycyB9KVxuICAgICAgICApLFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgIFwiZGl2XCIsXG4gICAgICAgICAgeyBpZDogXCJzZW5kXCIsIGNsYXNzTmFtZTogXCJjb2wgczEyXCIgfSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFNlbmRQYWdlLCB7XG4gICAgICAgICAgICB1c2VyczogdGhpcy5zdGF0ZS51c2VycyB9KVxuICAgICAgICApXG4gICAgICApXG4gICAgKTtcbiAgfVxufSk7XG5cblJlYWN0LnJlbmRlcihSZWFjdC5jcmVhdGVFbGVtZW50KEFwcCwgbnVsbCksIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVhY3Qtcm9vdFwiKSk7XG5cblxuLyoqIFdFQlBBQ0sgRk9PVEVSICoqXG4gKiogL1VzZXJzL3JhbS9kZXYvanMvd2FpZ28tZnJhbWV3b3JrL3dhaWdvL34vYmFiZWwtbG9hZGVyP2V4cGVyaW1lbnRhbCZvcHRpb25hbD1ydW50aW1lIS4vcGFnZXMvZW1haWxzL2FwcC5qc1xuICoqLyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XG5cbnZhciBCdXR0b24gPSByZXF1aXJlKFwiLi4vLi4vY29tcG9uZW50cy9idXR0b25cIik7XG52YXIgTW9kZWxUYWJsZSA9IHJlcXVpcmUoXCIuLi8uLi9jb21wb25lbnRzL21vZGVsVGFibGVcIik7XG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICBkaXNwbGF5TmFtZTogXCJleHBvcnRzXCIsXG5cbiAgcHJvcFR5cGVzOiB7XG4gICAgdXNlcnM6IFJlYWN0LlByb3BUeXBlcy5hcnJheSxcbiAgICBhZGRVc2VyOiBSZWFjdC5Qcm9wVHlwZXMuZnVuYyB9LFxuXG4gIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyczogW10sXG4gICAgICBhZGRVc2VyOiBudWxsIH07XG4gIH0sXG5cbiAgb25Sb3dDbGljazogZnVuY3Rpb24gb25Sb3dDbGljayh1c2VyKSB7XG4gICAgdGhpcy5wcm9wcy5hZGRVc2VyKHVzZXIpO1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciBjb2x1bW5zID0gW3tcbiAgICAgIG5hbWU6IFwidXNlcm5hbWVcIlxuICAgIH1dO1xuXG4gICAgdmFyIHVzZXJzID0gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgIFwiZW1cIixcbiAgICAgIG51bGwsXG4gICAgICBcIk5vbmUgc2VsZWN0ZWRcIlxuICAgICk7XG5cbiAgICBpZiAodGhpcy5wcm9wcy51c2Vycy5sZW5ndGgpIHtcbiAgICAgIHVzZXJzID0gdGhpcy5wcm9wcy51c2Vycy5tYXAoZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgXCJsaVwiLFxuICAgICAgICAgIHsgY2xhc3NOYW1lOiBcImNvbGxlY3Rpb24taXRlbVwiIH0sXG4gICAgICAgICAgdXNlci51c2VybmFtZSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgXCJhXCIsXG4gICAgICAgICAgICB7IGhyZWY6IFwiIyFcIiwgY2xhc3NOYW1lOiBcInNlY29uZGFyeS1jb250ZW50XCIsXG4gICAgICAgICAgICAgIFwiZGF0YS1pZFwiOiB1c2VyLl9pZCwgb25DbGljazogc2VsZi5fb25SZW1vdmVVc2VyIH0sXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaVwiLCB7IGNsYXNzTmFtZTogXCJmYSBmYS1yZW1vdmVcIiB9KVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuXG4gICAgICB1c2VycyA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgIFwiZGl2XCIsXG4gICAgICAgIG51bGwsXG4gICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoQnV0dG9uLCB7IGxhYmVsOiBcIkNsZWFyIGFsbFwiLCBzaXplOiBcInNtYWxsXCIsIG9uQ2xpY2s6IHRoaXMuX29uQ2xlYXIgfSksXG4gICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgXCJ1bFwiLFxuICAgICAgICAgIHsgY2xhc3NOYW1lOiBcImNvbGxlY3Rpb25cIiB9LFxuICAgICAgICAgIHVzZXJzXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICBcImRpdlwiLFxuICAgICAgeyBjbGFzc05hbWU6IFwicm93XCIgfSxcbiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgIFwiZGl2XCIsXG4gICAgICAgIHsgY2xhc3NOYW1lOiBcImNvbCBzMTIgbTVcIiB9LFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KE1vZGVsVGFibGUsIHtcbiAgICAgICAgICBtb2RlbE5hbWU6IFwiVXNlclwiLFxuICAgICAgICAgIGNvbHVtbnM6IGNvbHVtbnMsXG4gICAgICAgICAgZXhjbHVkZVJvd3M6IHRoaXMucHJvcHMudXNlcnMsXG4gICAgICAgICAgb25Sb3dDbGljazogdGhpcy5vblJvd0NsaWNrIH0pXG4gICAgICApLFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJkaXZcIixcbiAgICAgICAgeyBjbGFzc05hbWU6IFwiY29sIHMxMiBtNiBvZmZzZXQtbTEgc2VsZWN0ZWQtdXNlcnNcIiB9LFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgIFwiaDJcIixcbiAgICAgICAgICBudWxsLFxuICAgICAgICAgIFwiU2VsZWN0ZWQgdXNlcnM6XCJcbiAgICAgICAgKSxcbiAgICAgICAgdXNlcnNcbiAgICAgIClcbiAgICApO1xuICB9LFxuXG4gIF9vblJlbW92ZVVzZXI6IGZ1bmN0aW9uIF9vblJlbW92ZVVzZXIoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgIHRoaXMucHJvcHMucmVtb3ZlVXNlcihlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5pZCk7XG4gIH0sXG5cbiAgX29uQ2xlYXI6IGZ1bmN0aW9uIF9vbkNsZWFyKCkge1xuICAgIHRoaXMucHJvcHMuY2xlYXJVc2VycygpO1xuICB9IH0pO1xuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC9Vc2Vycy9yYW0vZGV2L2pzL3dhaWdvLWZyYW1ld29yay93YWlnby9+L2JhYmVsLWxvYWRlcj9leHBlcmltZW50YWwmb3B0aW9uYWw9cnVudGltZSEuL3BhZ2VzL2VtYWlscy91c2Vycy5qc1xuICoqLyIsIlwidXNlIHN0cmljdFwiO1xuXG52YXIgUmVhY3QgPSByZXF1aXJlKFwicmVhY3RcIik7XG5cbnZhciBUaW1lciA9IHJlcXVpcmUoXCJjbG9ja21ha2VyXCIpLlRpbWVyO1xuXG52YXIgUmVuZGVyVXRpbHMgPSByZXF1aXJlKFwiLi4vLi4vdXRpbHMvcmVuZGVyVXRpbHNcIiksXG4gICAgR3VhcmRlZFN0YXRlTWl4aW4gPSByZXF1aXJlKFwiLi4vLi4vbWl4aW5zL2d1YXJkZWRTdGF0ZVwiKTtcblxudmFyIEJ1dHRvbiA9IHJlcXVpcmUoXCIuLi8uLi9jb21wb25lbnRzL2J1dHRvblwiKSxcbiAgICBMb2FkZXIgPSByZXF1aXJlKFwiLi4vLi4vY29tcG9uZW50cy9sb2FkZXJcIiksXG4gICAgVGV4dEVkaXRvciA9IHJlcXVpcmUoXCIuLi8uLi9jb21wb25lbnRzL3RleHRFZGl0b3JcIik7XG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICBkaXNwbGF5TmFtZTogXCJleHBvcnRzXCIsXG5cbiAgbWl4aW5zOiBbR3VhcmRlZFN0YXRlTWl4aW5dLFxuXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0ZW1wbGF0ZTogXCJcIixcbiAgICAgIHJlbmRlcmVkOiBcIlwiLFxuICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICBlcnJvcjogbnVsbCB9O1xuICB9LFxuXG4gIHByb3BUeXBlczoge1xuICAgIHVzZXJzOiBSZWFjdC5Qcm9wVHlwZXMuYXJyYXkgfSxcblxuICBnZXREZWZhdWx0UHJvcHM6IGZ1bmN0aW9uIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcnM6IFtdIH07XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgdmFyIG51bVVzZXJzID0gdGhpcy5wcm9wcy51c2Vycy5sZW5ndGg7XG5cbiAgICBpZiAoIW51bVVzZXJzKSB7XG4gICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJlbVwiLFxuICAgICAgICBudWxsLFxuICAgICAgICBcIlBsZWFzZSBzZWxlY3Qgc29tZSB1c2VycyB0byBzZW5kIHRvLlwiXG4gICAgICApO1xuICAgIH1cblxuICAgIHZhciBzZW5kQnRuTGFiZWwgPSBcIlNlbmQgdG8gXCIgKyBudW1Vc2VycyArIFwiIFwiICsgKDEgPT0gbnVtVXNlcnMgPyBcInVzZXJcIiA6IFwidXNlcnNcIik7XG5cbiAgICB2YXIgYnJhY2tldHNTeW50YXggPSBcInt7Li4ufX1cIjtcblxuICAgIHZhciB0aXBzID0gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgIFwicFwiLFxuICAgICAgeyBjbGFzc05hbWU6IFwidGlwc1wiIH0sXG4gICAgICBcIk5PVEU6IEFsbCBhcHAtbGV2ZWwgbG9jYWxzIGFzIHdlbGwgYXMgXCIsXG4gICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICBcImNvZGVcIixcbiAgICAgICAgbnVsbCxcbiAgICAgICAgXCJyZWNpcGllbnRcIlxuICAgICAgKSxcbiAgICAgIFwiIGFyZSBhdmFpbGFibGUgYXMgdGVtcGxhdGUgdmFyaWFibGVzLiBVc2UgXCIsXG4gICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICBcImNvZGVcIixcbiAgICAgICAgbnVsbCxcbiAgICAgICAgYnJhY2tldHNTeW50YXhcbiAgICAgICksXG4gICAgICBcIiBzeW50YXggdG8gaW5zZXJ0LlwiXG4gICAgKTtcblxuICAgIHZhciBsb2FkaW5nQW5pbSA9IG51bGw7XG5cbiAgICBpZiAodGhpcy5zdGF0ZS5sb2FkaW5nKSB7XG4gICAgICBsb2FkaW5nQW5pbSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoTG9hZGVyLCB7IHNpemU6IFwic21hbGxcIiwgaW5saW5lOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgXCJkaXZcIixcbiAgICAgIHsgY2xhc3NOYW1lOiBcImNvbnRlbnQtc2VuZFwiIH0sXG4gICAgICB0aXBzLFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJkaXZcIixcbiAgICAgICAgeyBjbGFzc05hbWU6IFwicm93XCIgfSxcbiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICBcImRpdlwiLFxuICAgICAgICAgIHsgY2xhc3NOYW1lOiBcImNvbCBtNiBzMTJcIiB9LFxuICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgICBcImgyXCIsXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgXCJNYXJrZG93blwiXG4gICAgICAgICAgKSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRleHRFZGl0b3IsIHsgaGVpZ2h0OiBcIjQwMHB4XCIsIG9uQ2hhbmdlOiB0aGlzLl9vblRlbXBsYXRlVXBkYXRlIH0pXG4gICAgICAgICksXG4gICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgXCJkaXZcIixcbiAgICAgICAgICB7IGNsYXNzTmFtZTogXCJjb2wgbTYgbS1vZmZzZXQxIHMxMlwiIH0sXG4gICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFwiaDJcIixcbiAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICBcInNwYW5cIixcbiAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgXCJQcmV2aWV3XCJcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBsb2FkaW5nQW5pbVxuICAgICAgICAgICksXG4gICAgICAgICAgUmVuZGVyVXRpbHMuYnVpbGRFcnJvcih0aGlzLnN0YXRlLmVycm9yKSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcInByZXZpZXdcIixcbiAgICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7IF9faHRtbDogdGhpcy5zdGF0ZS5yZW5kZXJlZCB9IH0pXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEJ1dHRvbiwgeyBsYWJlbDogc2VuZEJ0bkxhYmVsIH0pXG4gICAgKTtcbiAgfSxcblxuICBfb25UZW1wbGF0ZVVwZGF0ZTogZnVuY3Rpb24gX29uVGVtcGxhdGVVcGRhdGUodGV4dCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgdGVtcGxhdGU6IHRleHRcbiAgICB9KTtcblxuICAgIHRoaXMuX2ZldGNoUHJldmlldygpO1xuICB9LFxuXG4gIF9mZXRjaFByZXZpZXc6IGZ1bmN0aW9uIF9mZXRjaFByZXZpZXcoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgLy8gaWYgbm90IHVzZXJzIGRvbid0IGZldGNoXG4gICAgaWYgKCF0aGlzLnByb3BzLnVzZXJzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGdpdmUgdGltZSBmb3IgbXVsdGlwbGUgc3VjY2Vzc2l2ZSB0ZW1wbGF0ZSBjaGFuZ2VzIHRvIHRha2UgcGxhY2VcbiAgICBpZiAoc2VsZi5fZmV0Y2hQcmV2aWV3VGltZXIpIHtcbiAgICAgIHNlbGYuX2ZldGNoUHJldmlld1RpbWVyLnN0b3AoKTtcbiAgICB9XG5cbiAgICBzZWxmLl9mZXRjaFByZXZpZXdUaW1lciA9IFRpbWVyKGZ1bmN0aW9uICgpIHtcblxuICAgICAgc2VsZi5zZXRTdGF0ZSh7XG4gICAgICAgIGxvYWRpbmc6IHRydWUsXG4gICAgICAgIGVycm9yOiBudWxsIH0pO1xuXG4gICAgICAvLyBmZXRjaCBjb2xsZWN0aW9uIHJvd3NcbiAgICAgICQuYWpheCh7XG4gICAgICAgIHVybDogXCIvYWRtaW4vZW1haWxzL3JlbmRlcj9mb3JtYXQ9anNvblwiLFxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdGVtcGxhdGU6IHNlbGYuc3RhdGUudGVtcGxhdGUsXG4gICAgICAgICAgdXNlcjogc2VsZi5wcm9wcy51c2Vyc1swXS5faWRcbiAgICAgICAgfVxuICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBzZWxmLnNldFN0YXRlSWZNb3VudGVkKHtcbiAgICAgICAgICByZW5kZXJlZDogZGF0YS5odG1sIH0pO1xuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoeGhyKSB7XG4gICAgICAgIHNlbGYuc2V0U3RhdGVJZk1vdW50ZWQoe1xuICAgICAgICAgIGVycm9yOiB4aHJcbiAgICAgICAgfSk7XG4gICAgICB9KS5hbHdheXMoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLnNldFN0YXRlSWZNb3VudGVkKHtcbiAgICAgICAgICBsb2FkaW5nOiBmYWxzZSB9KTtcbiAgICAgIH0pO1xuICAgIH0sIDMwMCkuc3RhcnQoKTtcbiAgfSB9KTtcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAvVXNlcnMvcmFtL2Rldi9qcy93YWlnby1mcmFtZXdvcmsvd2FpZ28vfi9iYWJlbC1sb2FkZXI/ZXhwZXJpbWVudGFsJm9wdGlvbmFsPXJ1bnRpbWUhLi9wYWdlcy9lbWFpbHMvc2VuZC5qc1xuICoqLyJdLCJzb3VyY2VSb290IjoiIiwiZmlsZSI6ImFkbWluLmVtYWlscy5qcyJ9