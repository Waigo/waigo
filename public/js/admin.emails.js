webpackJsonp([2],{

/***/ 0:
/***/ function(module, exports, __webpack_require__) {

	"use strict";
	
	var React = __webpack_require__(17);
	
	var _ = __webpack_require__(14);
	
	var UsersPage = __webpack_require__(26);
	var SendPage = __webpack_require__(27);
	
	var App = React.createClass({
	  displayName: "App",
	
	  getInitialState: function getInitialState() {
	    return {
	      users: [],
	      template: "" };
	  },
	  addUser: function addUser(user) {
	    var existing = _.find(this.state.users, function (u) {
	      return u._id === user._id;
	    });
	
	    if (!existing) {
	      this.setState({
	        users: this.state.users.concat([user])
	      });
	    }
	  },
	  removeUser: function removeUser(userOrId) {
	    if (userOrId._id) {
	      userOrId = userOrId._id;
	    }
	
	    var newUsers = this.state.users.filter(function (u) {
	      return u._id !== userOrId;
	    });
	
	    this.setState({
	      users: newUsers
	    });
	  },
	  clearUsers: function clearUsers() {
	    this.setState({
	      users: []
	    });
	  },
	  render: function render() {
	    return React.createElement(
	      "div",
	      { className: "row page-emails" },
	      React.createElement(
	        "div",
	        { className: "col s12" },
	        React.createElement(
	          "ul",
	          { className: "tabs" },
	          React.createElement(
	            "li",
	            { className: "tab col s3" },
	            React.createElement(
	              "a",
	              { className: "active", href: "#users" },
	              React.createElement(
	                "span",
	                { "class": "badge" },
	                "1."
	              ),
	              " Select users"
	            )
	          ),
	          React.createElement(
	            "li",
	            { className: "tab col s3" },
	            React.createElement(
	              "a",
	              { href: "#send" },
	              React.createElement(
	                "span",
	                { "class": "badge" },
	                "2."
	              ),
	              " Send"
	            )
	          )
	        )
	      ),
	      React.createElement(
	        "section",
	        { className: "tab-content" },
	        React.createElement(
	          "div",
	          { id: "users", className: "col s12" },
	          React.createElement(UsersPage, {
	            users: this.state.users,
	            addUser: this.addUser,
	            removeUser: this.removeUser,
	            clearUsers: this.clearUsers })
	        ),
	        React.createElement(
	          "div",
	          { id: "send", className: "col s12" },
	          React.createElement(SendPage, {
	            users: this.state.users })
	        )
	      )
	    );
	  }
	});
	
	React.render(React.createElement(App, null), document.getElementById("react-root"));

/***/ },

/***/ 26:
/***/ function(module, exports, __webpack_require__) {

	"use strict";
	
	var React = __webpack_require__(17);
	
	var Button = __webpack_require__(2);
	var ModelTable = __webpack_require__(9);
	
	module.exports = React.createClass({
	  displayName: "exports",
	
	  propTypes: {
	    users: React.PropTypes.array,
	    addUser: React.PropTypes.func },
	
	  getDefaultProps: function getDefaultProps() {
	    return {
	      users: [],
	      addUser: null };
	  },
	
	  onRowClick: function onRowClick(user) {
	    this.props.addUser(user);
	  },
	
	  render: function render() {
	    var self = this;
	
	    var columns = [{
	      name: "username"
	    }];
	
	    var users = React.createElement(
	      "em",
	      null,
	      "None selected"
	    );
	
	    if (this.props.users.length) {
	      users = this.props.users.map(function (user) {
	        return React.createElement(
	          "li",
	          { className: "collection-item" },
	          user.username,
	          React.createElement(
	            "a",
	            { href: "#!", className: "secondary-content",
	              "data-id": user._id, onClick: self._onRemoveUser },
	            React.createElement("i", { className: "fa fa-remove" })
	          )
	        );
	      });
	
	      users = React.createElement(
	        "div",
	        null,
	        React.createElement(Button, { label: "Clear all", size: "small", onClick: this._onClear }),
	        React.createElement(
	          "ul",
	          { className: "collection" },
	          users
	        )
	      );
	    }
	
	    return React.createElement(
	      "div",
	      { className: "row" },
	      React.createElement(
	        "div",
	        { className: "col s12 m5" },
	        React.createElement(ModelTable, {
	          modelName: "User",
	          columns: columns,
	          excludeRows: this.props.users,
	          onRowClick: this.onRowClick })
	      ),
	      React.createElement(
	        "div",
	        { className: "col s12 m6 offset-m1 selected-users" },
	        React.createElement(
	          "h2",
	          null,
	          "Selected users:"
	        ),
	        users
	      )
	    );
	  },
	
	  _onRemoveUser: function _onRemoveUser(e) {
	    e.preventDefault();
	
	    this.props.removeUser(e.currentTarget.dataset.id);
	  },
	
	  _onClear: function _onClear() {
	    this.props.clearUsers();
	  } });

/***/ },

/***/ 27:
/***/ function(module, exports, __webpack_require__) {

	"use strict";
	
	var React = __webpack_require__(17);
	
	var Timer = __webpack_require__(16).Timer;
	
	var RenderUtils = __webpack_require__(15),
	    GuardedStateMixin = __webpack_require__(13);
	
	var Button = __webpack_require__(2),
	    Loader = __webpack_require__(7),
	    TextEditor = __webpack_require__(12);
	
	module.exports = React.createClass({
	  displayName: "exports",
	
	  mixins: [GuardedStateMixin],
	
	  getInitialState: function getInitialState() {
	    return {
	      subject: "",
	      body: "",
	      subjectPreview: "",
	      bodyPreview: "",
	      loading: false,
	      sending: false,
	      error: null,
	      sendError: null };
	  },
	
	  propTypes: {
	    users: React.PropTypes.array },
	
	  getDefaultProps: function getDefaultProps() {
	    return {
	      users: [] };
	  },
	
	  render: function render() {
	    var numUsers = this.props.users.length;
	
	    if (!numUsers) {
	      return React.createElement(
	        "em",
	        null,
	        "Please select some users to send to."
	      );
	    }
	
	    var bracketsSyntax = "{{...}}";
	
	    var tips = React.createElement(
	      "p",
	      { className: "tips" },
	      "NOTE: All app-level locals as well as ",
	      React.createElement(
	        "code",
	        null,
	        "recipient"
	      ),
	      " are available as template variables. Use ",
	      React.createElement(
	        "code",
	        null,
	        bracketsSyntax
	      ),
	      " syntax to insert."
	    );
	
	    var loadingAnim = null;
	    if (this.state.loading) {
	      loadingAnim = React.createElement(Loader, { size: "small", inline: true });
	    }
	
	    return React.createElement(
	      "form",
	      { className: "content-send" },
	      tips,
	      React.createElement(
	        "div",
	        { className: "row" },
	        React.createElement(
	          "div",
	          { className: "col m6 s12 fields" },
	          React.createElement(
	            "h2",
	            null,
	            "Markdown"
	          ),
	          React.createElement("input", { type: "text",
	            className: "subject",
	            onKeyUp: this._onSubjectChange,
	            placeholder: "Subject",
	            ref: "subject" }),
	          React.createElement(TextEditor, { height: "400px",
	            onChange: this._onBodyChange,
	            ref: "body" })
	        ),
	        React.createElement(
	          "div",
	          { className: "col m6 m-offset1 s12 preview" },
	          React.createElement(
	            "h2",
	            null,
	            React.createElement(
	              "span",
	              null,
	              "Preview"
	            ),
	            loadingAnim
	          ),
	          RenderUtils.buildError(this.state.error),
	          React.createElement("input", { type: "text", readonly: true, value: this.state.subjectPreview, placeholder: "Subject preview..." }),
	          React.createElement("div", { className: "body",
	            dangerouslySetInnerHTML: { __html: this.state.bodyPreview } })
	        )
	      ),
	      this._buildSendButton()
	    );
	  },
	
	  _buildSendButton: function _buildSendButton() {
	    var numUsers = this.props.users.length;
	
	    var sendButton = null,
	        sendAnim = null,
	        sendBtnLabel = "Send to " + numUsers + " " + (1 == numUsers ? "user" : "users");
	
	    if (this.state.sending) {
	      sendButton = React.createElement(Button, { label: sendBtnLabel, disabled: true });
	      sendAnim = React.createElement(Loader, { inline: true });
	    } else {
	      sendButton = React.createElement(Button, { label: sendBtnLabel, onClick: this._onSend });
	    }
	
	    return React.createElement(
	      "div",
	      { className: "send-info" },
	      sendButton,
	      React.createElement(
	        "div",
	        { className: "send-result" },
	        sendAnim,
	        RenderUtils.buildError(this.state.sendError)
	      )
	    );
	  },
	
	  _onSubjectChange: function _onSubjectChange(e) {
	    this.setState({
	      subject: e.currentTarget.value
	    });
	
	    this._fetchPreview();
	  },
	
	  _onBodyChange: function _onBodyChange(text) {
	    this.setState({
	      body: text
	    });
	
	    this._fetchPreview();
	  },
	
	  _fetchPreview: function _fetchPreview() {
	    var self = this;
	
	    // if not users don't fetch
	    if (!this.props.users.length) {
	      return;
	    }
	
	    // give time for multiple successive template changes to take place
	    if (self._fetchPreviewTimer) {
	      self._fetchPreviewTimer.stop();
	    }
	
	    self._fetchPreviewTimer = Timer(function () {
	
	      self.setState({
	        loading: true,
	        error: null });
	
	      // fetch collection rows
	      $.ajax({
	        url: "/admin/emails/render?format=json",
	        method: "POST",
	        data: {
	          subject: self.state.subject,
	          body: self.state.body,
	          user: self.props.users[0]._id
	        }
	      }).done(function (data) {
	        self.setStateIfMounted({
	          subjectPreview: data.subject || "",
	          bodyPreview: data.body || "" });
	      }).fail(function (xhr) {
	        self.setStateIfMounted({
	          error: xhr
	        });
	      }).always(function () {
	        self.setStateIfMounted({
	          loading: false });
	      });
	    }, 300).start();
	  },
	
	  _onSend: function _onSend() {
	    var self = this;
	
	    // if not users don't fetch
	    if (!this.props.users.length) {
	      return;
	    }
	
	    this.setState({
	      sending: true,
	      sendError: null });
	
	    // fetch collection rows
	    $.ajax({
	      url: "/admin/emails/send?format=json",
	      method: "POST",
	      data: {
	        subject: self.state.subject,
	        body: self.state.body,
	        users: self.props.users.map(function (v) {
	          return v._id;
	        }) }
	    }).done(function () {
	      Materialize.toast("Email succesfully sent", 2000, "rounded");
	
	      // clear inputs
	      self.refs.body.clear();
	      React.findDOMNode(self.refs.subject).value = "";
	
	      self.setStateIfMounted({
	        subject: "",
	        body: "",
	        subjectPreview: "",
	        bodyPreview: "" });
	    }).fail(function (xhr) {
	      self.setStateIfMounted({
	        sendError: xhr
	      });
	    }).always(function () {
	      self.setStateIfMounted({
	        sending: false });
	    });
	  } });

/***/ }

});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wYWdlcy9lbWFpbHMvYXBwLmpzIiwid2VicGFjazovLy8uL3BhZ2VzL2VtYWlscy91c2Vycy5qcyIsIndlYnBhY2s6Ly8vLi9wYWdlcy9lbWFpbHMvc2VuZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLGFBQVksQ0FBQzs7QUFFYixLQUFJLEtBQUssR0FBRyxtQkFBTyxDQUFDLEVBQU8sQ0FBQyxDQUFDOztBQUU3QixLQUFJLENBQUMsR0FBRyxtQkFBTyxDQUFDLEVBQW9CLENBQUMsQ0FBQzs7QUFFdEMsS0FBSSxTQUFTLEdBQUcsbUJBQU8sQ0FBQyxFQUFTLENBQUMsQ0FBQztBQUNuQyxLQUFJLFFBQVEsR0FBRyxtQkFBTyxDQUFDLEVBQVEsQ0FBQyxDQUFDOztBQUVqQyxLQUFJLEdBQUcsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDO0FBQzVCLEdBQUUsV0FBVyxFQUFFLEtBQUs7O0dBRWxCLGVBQWUsRUFBRSxTQUFTLGVBQWUsR0FBRztLQUMxQyxPQUFPO09BQ0wsS0FBSyxFQUFFLEVBQUU7T0FDVCxRQUFRLEVBQUUsRUFBRSxFQUFFLENBQUM7SUFDbEI7R0FDRCxPQUFPLEVBQUUsU0FBUyxPQUFPLENBQUMsSUFBSSxFQUFFO0tBQzlCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLEVBQUU7T0FDbkQsT0FBTyxDQUFDLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUM7QUFDaEMsTUFBSyxDQUFDLENBQUM7O0tBRUgsSUFBSSxDQUFDLFFBQVEsRUFBRTtPQUNiLElBQUksQ0FBQyxRQUFRLENBQUM7U0FDWixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDO01BQ0o7SUFDRjtHQUNELFVBQVUsRUFBRSxT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O0lBQ0osRUFBRSxDQUFDLEMiLCJmaWxlIjoiYWRtaW4uZW1haWxzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBSZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcblxudmFyIF8gPSByZXF1aXJlKFwiLi4vLi4vdXRpbHMvbG9kYXNoXCIpO1xuXG52YXIgVXNlcnNQYWdlID0gcmVxdWlyZShcIi4vdXNlcnNcIik7XG52YXIgU2VuZFBhZ2UgPSByZXF1aXJlKFwiLi9zZW5kXCIpO1xuXG52YXIgQXBwID0gUmVhY3QuY3JlYXRlQ2xhc3Moe1xuICBkaXNwbGF5TmFtZTogXCJBcHBcIixcblxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcnM6IFtdLFxuICAgICAgdGVtcGxhdGU6IFwiXCIgfTtcbiAgfSxcbiAgYWRkVXNlcjogZnVuY3Rpb24gYWRkVXNlcih1c2VyKSB7XG4gICAgdmFyIGV4aXN0aW5nID0gXy5maW5kKHRoaXMuc3RhdGUudXNlcnMsIGZ1bmN0aW9uICh1KSB7XG4gICAgICByZXR1cm4gdS5faWQgPT09IHVzZXIuX2lkO1xuICAgIH0pO1xuXG4gICAgaWYgKCFleGlzdGluZykge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHVzZXJzOiB0aGlzLnN0YXRlLnVzZXJzLmNvbmNhdChbdXNlcl0pXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIHJlbW92ZVVzZXI6IGZ1bmN0aW9uIHJlbW92ZVVzZXIodXNlck9ySWQpIHtcbiAgICBpZiAodXNlck9ySWQuX2lkKSB7XG4gICAgICB1c2VyT3JJZCA9IHVzZXJPcklkLl9pZDtcbiAgICB9XG5cbiAgICB2YXIgbmV3VXNlcnMgPSB0aGlzLnN0YXRlLnVzZXJzLmZpbHRlcihmdW5jdGlvbiAodSkge1xuICAgICAgcmV0dXJuIHUuX2lkICE9PSB1c2VyT3JJZDtcbiAgICB9KTtcblxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgdXNlcnM6IG5ld1VzZXJzXG4gICAgfSk7XG4gIH0sXG4gIGNsZWFyVXNlcnM6IGZ1bmN0aW9uIGNsZWFyVXNlcnMoKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICB1c2VyczogW11cbiAgICB9KTtcbiAgfSxcbiAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICBcImRpdlwiLFxuICAgICAgeyBjbGFzc05hbWU6IFwicm93IHBhZ2UtZW1haWxzXCIgfSxcbiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgIFwiZGl2XCIsXG4gICAgICAgIHsgY2xhc3NOYW1lOiBcImNvbCBzMTJcIiB9LFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgIFwidWxcIixcbiAgICAgICAgICB7IGNsYXNzTmFtZTogXCJ0YWJzXCIgfSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgXCJsaVwiLFxuICAgICAgICAgICAgeyBjbGFzc05hbWU6IFwidGFiIGNvbCBzM1wiIH0sXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICBcImFcIixcbiAgICAgICAgICAgICAgeyBjbGFzc05hbWU6IFwiYWN0aXZlXCIsIGhyZWY6IFwiI3VzZXJzXCIgfSxcbiAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICBcInNwYW5cIixcbiAgICAgICAgICAgICAgICB7IFwiY2xhc3NcIjogXCJiYWRnZVwiIH0sXG4gICAgICAgICAgICAgICAgXCIxLlwiXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIFwiIFNlbGVjdCB1c2Vyc1wiXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgXCJsaVwiLFxuICAgICAgICAgICAgeyBjbGFzc05hbWU6IFwidGFiIGNvbCBzM1wiIH0sXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICBcImFcIixcbiAgICAgICAgICAgICAgeyBocmVmOiBcIiNzZW5kXCIgfSxcbiAgICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgICAgICBcInNwYW5cIixcbiAgICAgICAgICAgICAgICB7IFwiY2xhc3NcIjogXCJiYWRnZVwiIH0sXG4gICAgICAgICAgICAgICAgXCIyLlwiXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIFwiIFNlbmRcIlxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKSxcbiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgIFwic2VjdGlvblwiLFxuICAgICAgICB7IGNsYXNzTmFtZTogXCJ0YWItY29udGVudFwiIH0sXG4gICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgICAgXCJkaXZcIixcbiAgICAgICAgICB7IGlkOiBcInVzZXJzXCIsIGNsYXNzTmFtZTogXCJjb2wgczEyXCIgfSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFVzZXJzUGFnZSwge1xuICAgICAgICAgICAgdXNlcnM6IHRoaXMuc3RhdGUudXNlcnMsXG4gICAgICAgICAgICBhZGRVc2VyOiB0aGlzLmFkZFVzZXIsXG4gICAgICAgICAgICByZW1vdmVVc2VyOiB0aGlzLnJlbW92ZVVzZXIsXG4gICAgICAgICAgICBjbGVhclVzZXJzOiB0aGlzLmNsZWFyVXNlcnMgfSlcbiAgICAgICAgKSxcbiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICBcImRpdlwiLFxuICAgICAgICAgIHsgaWQ6IFwic2VuZFwiLCBjbGFzc05hbWU6IFwiY29sIHMxMlwiIH0sXG4gICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChTZW5kUGFnZSwge1xuICAgICAgICAgICAgdXNlcnM6IHRoaXMuc3RhdGUudXNlcnMgfSlcbiAgICAgICAgKVxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG5SZWFjdC5yZW5kZXIoUmVhY3QuY3JlYXRlRWxlbWVudChBcHAsIG51bGwpLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlYWN0LXJvb3RcIikpO1xuXG5cbi8qKiBXRUJQQUNLIEZPT1RFUiAqKlxuICoqIC9Vc2Vycy9yYW0vZGV2L2pzL3dhaWdvLWZyYW1ld29yay93YWlnby9+L2JhYmVsLWxvYWRlcj9leHBlcmltZW50YWwmb3B0aW9uYWw9cnVudGltZSEuL3BhZ2VzL2VtYWlscy9hcHAuanNcbiAqKi8iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xuXG52YXIgQnV0dG9uID0gcmVxdWlyZShcIi4uLy4uL2NvbXBvbmVudHMvYnV0dG9uXCIpO1xudmFyIE1vZGVsVGFibGUgPSByZXF1aXJlKFwiLi4vLi4vY29tcG9uZW50cy9tb2RlbFRhYmxlXCIpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgZGlzcGxheU5hbWU6IFwiZXhwb3J0c1wiLFxuXG4gIHByb3BUeXBlczoge1xuICAgIHVzZXJzOiBSZWFjdC5Qcm9wVHlwZXMuYXJyYXksXG4gICAgYWRkVXNlcjogUmVhY3QuUHJvcFR5cGVzLmZ1bmMgfSxcblxuICBnZXREZWZhdWx0UHJvcHM6IGZ1bmN0aW9uIGdldERlZmF1bHRQcm9wcygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcnM6IFtdLFxuICAgICAgYWRkVXNlcjogbnVsbCB9O1xuICB9LFxuXG4gIG9uUm93Q2xpY2s6IGZ1bmN0aW9uIG9uUm93Q2xpY2sodXNlcikge1xuICAgIHRoaXMucHJvcHMuYWRkVXNlcih1c2VyKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgY29sdW1ucyA9IFt7XG4gICAgICBuYW1lOiBcInVzZXJuYW1lXCJcbiAgICB9XTtcblxuICAgIHZhciB1c2VycyA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICBcImVtXCIsXG4gICAgICBudWxsLFxuICAgICAgXCJOb25lIHNlbGVjdGVkXCJcbiAgICApO1xuXG4gICAgaWYgKHRoaXMucHJvcHMudXNlcnMubGVuZ3RoKSB7XG4gICAgICB1c2VycyA9IHRoaXMucHJvcHMudXNlcnMubWFwKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgIFwibGlcIixcbiAgICAgICAgICB7IGNsYXNzTmFtZTogXCJjb2xsZWN0aW9uLWl0ZW1cIiB9LFxuICAgICAgICAgIHVzZXIudXNlcm5hbWUsXG4gICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFwiYVwiLFxuICAgICAgICAgICAgeyBocmVmOiBcIiMhXCIsIGNsYXNzTmFtZTogXCJzZWNvbmRhcnktY29udGVudFwiLFxuICAgICAgICAgICAgICBcImRhdGEtaWRcIjogdXNlci5faWQsIG9uQ2xpY2s6IHNlbGYuX29uUmVtb3ZlVXNlciB9LFxuICAgICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlcIiwgeyBjbGFzc05hbWU6IFwiZmEgZmEtcmVtb3ZlXCIgfSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgdXNlcnMgPSBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICBcImRpdlwiLFxuICAgICAgICBudWxsLFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KEJ1dHRvbiwgeyBsYWJlbDogXCJDbGVhciBhbGxcIiwgc2l6ZTogXCJzbWFsbFwiLCBvbkNsaWNrOiB0aGlzLl9vbkNsZWFyIH0pLFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgIFwidWxcIixcbiAgICAgICAgICB7IGNsYXNzTmFtZTogXCJjb2xsZWN0aW9uXCIgfSxcbiAgICAgICAgICB1c2Vyc1xuICAgICAgICApXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgXCJkaXZcIixcbiAgICAgIHsgY2xhc3NOYW1lOiBcInJvd1wiIH0sXG4gICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICBcImRpdlwiLFxuICAgICAgICB7IGNsYXNzTmFtZTogXCJjb2wgczEyIG01XCIgfSxcbiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChNb2RlbFRhYmxlLCB7XG4gICAgICAgICAgbW9kZWxOYW1lOiBcIlVzZXJcIixcbiAgICAgICAgICBjb2x1bW5zOiBjb2x1bW5zLFxuICAgICAgICAgIGV4Y2x1ZGVSb3dzOiB0aGlzLnByb3BzLnVzZXJzLFxuICAgICAgICAgIG9uUm93Q2xpY2s6IHRoaXMub25Sb3dDbGljayB9KVxuICAgICAgKSxcbiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgIFwiZGl2XCIsXG4gICAgICAgIHsgY2xhc3NOYW1lOiBcImNvbCBzMTIgbTYgb2Zmc2V0LW0xIHNlbGVjdGVkLXVzZXJzXCIgfSxcbiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICBcImgyXCIsXG4gICAgICAgICAgbnVsbCxcbiAgICAgICAgICBcIlNlbGVjdGVkIHVzZXJzOlwiXG4gICAgICAgICksXG4gICAgICAgIHVzZXJzXG4gICAgICApXG4gICAgKTtcbiAgfSxcblxuICBfb25SZW1vdmVVc2VyOiBmdW5jdGlvbiBfb25SZW1vdmVVc2VyKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB0aGlzLnByb3BzLnJlbW92ZVVzZXIoZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaWQpO1xuICB9LFxuXG4gIF9vbkNsZWFyOiBmdW5jdGlvbiBfb25DbGVhcigpIHtcbiAgICB0aGlzLnByb3BzLmNsZWFyVXNlcnMoKTtcbiAgfSB9KTtcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAvVXNlcnMvcmFtL2Rldi9qcy93YWlnby1mcmFtZXdvcmsvd2FpZ28vfi9iYWJlbC1sb2FkZXI/ZXhwZXJpbWVudGFsJm9wdGlvbmFsPXJ1bnRpbWUhLi9wYWdlcy9lbWFpbHMvdXNlcnMuanNcbiAqKi8iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIFJlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xuXG52YXIgVGltZXIgPSByZXF1aXJlKFwiY2xvY2ttYWtlclwiKS5UaW1lcjtcblxudmFyIFJlbmRlclV0aWxzID0gcmVxdWlyZShcIi4uLy4uL3V0aWxzL3JlbmRlclV0aWxzXCIpLFxuICAgIEd1YXJkZWRTdGF0ZU1peGluID0gcmVxdWlyZShcIi4uLy4uL21peGlucy9ndWFyZGVkU3RhdGVcIik7XG5cbnZhciBCdXR0b24gPSByZXF1aXJlKFwiLi4vLi4vY29tcG9uZW50cy9idXR0b25cIiksXG4gICAgTG9hZGVyID0gcmVxdWlyZShcIi4uLy4uL2NvbXBvbmVudHMvbG9hZGVyXCIpLFxuICAgIFRleHRFZGl0b3IgPSByZXF1aXJlKFwiLi4vLi4vY29tcG9uZW50cy90ZXh0RWRpdG9yXCIpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcbiAgZGlzcGxheU5hbWU6IFwiZXhwb3J0c1wiLFxuXG4gIG1peGluczogW0d1YXJkZWRTdGF0ZU1peGluXSxcblxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uIGdldEluaXRpYWxTdGF0ZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3ViamVjdDogXCJcIixcbiAgICAgIGJvZHk6IFwiXCIsXG4gICAgICBzdWJqZWN0UHJldmlldzogXCJcIixcbiAgICAgIGJvZHlQcmV2aWV3OiBcIlwiLFxuICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgICBzZW5kaW5nOiBmYWxzZSxcbiAgICAgIGVycm9yOiBudWxsLFxuICAgICAgc2VuZEVycm9yOiBudWxsIH07XG4gIH0sXG5cbiAgcHJvcFR5cGVzOiB7XG4gICAgdXNlcnM6IFJlYWN0LlByb3BUeXBlcy5hcnJheSB9LFxuXG4gIGdldERlZmF1bHRQcm9wczogZnVuY3Rpb24gZ2V0RGVmYXVsdFByb3BzKCkge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyczogW10gfTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICB2YXIgbnVtVXNlcnMgPSB0aGlzLnByb3BzLnVzZXJzLmxlbmd0aDtcblxuICAgIGlmICghbnVtVXNlcnMpIHtcbiAgICAgIHJldHVybiBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICBcImVtXCIsXG4gICAgICAgIG51bGwsXG4gICAgICAgIFwiUGxlYXNlIHNlbGVjdCBzb21lIHVzZXJzIHRvIHNlbmQgdG8uXCJcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdmFyIGJyYWNrZXRzU3ludGF4ID0gXCJ7ey4uLn19XCI7XG5cbiAgICB2YXIgdGlwcyA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICBcInBcIixcbiAgICAgIHsgY2xhc3NOYW1lOiBcInRpcHNcIiB9LFxuICAgICAgXCJOT1RFOiBBbGwgYXBwLWxldmVsIGxvY2FscyBhcyB3ZWxsIGFzIFwiLFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJjb2RlXCIsXG4gICAgICAgIG51bGwsXG4gICAgICAgIFwicmVjaXBpZW50XCJcbiAgICAgICksXG4gICAgICBcIiBhcmUgYXZhaWxhYmxlIGFzIHRlbXBsYXRlIHZhcmlhYmxlcy4gVXNlIFwiLFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJjb2RlXCIsXG4gICAgICAgIG51bGwsXG4gICAgICAgIGJyYWNrZXRzU3ludGF4XG4gICAgICApLFxuICAgICAgXCIgc3ludGF4IHRvIGluc2VydC5cIlxuICAgICk7XG5cbiAgICB2YXIgbG9hZGluZ0FuaW0gPSBudWxsO1xuICAgIGlmICh0aGlzLnN0YXRlLmxvYWRpbmcpIHtcbiAgICAgIGxvYWRpbmdBbmltID0gUmVhY3QuY3JlYXRlRWxlbWVudChMb2FkZXIsIHsgc2l6ZTogXCJzbWFsbFwiLCBpbmxpbmU6IHRydWUgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICBcImZvcm1cIixcbiAgICAgIHsgY2xhc3NOYW1lOiBcImNvbnRlbnQtc2VuZFwiIH0sXG4gICAgICB0aXBzLFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgXCJkaXZcIixcbiAgICAgICAgeyBjbGFzc05hbWU6IFwicm93XCIgfSxcbiAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICBcImRpdlwiLFxuICAgICAgICAgIHsgY2xhc3NOYW1lOiBcImNvbCBtNiBzMTIgZmllbGRzXCIgfSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgXCJoMlwiLFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIFwiTWFya2Rvd25cIlxuICAgICAgICAgICksXG4gICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcImlucHV0XCIsIHsgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwic3ViamVjdFwiLFxuICAgICAgICAgICAgb25LZXlVcDogdGhpcy5fb25TdWJqZWN0Q2hhbmdlLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiU3ViamVjdFwiLFxuICAgICAgICAgICAgcmVmOiBcInN1YmplY3RcIiB9KSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFRleHRFZGl0b3IsIHsgaGVpZ2h0OiBcIjQwMHB4XCIsXG4gICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5fb25Cb2R5Q2hhbmdlLFxuICAgICAgICAgICAgcmVmOiBcImJvZHlcIiB9KVxuICAgICAgICApLFxuICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgIFwiZGl2XCIsXG4gICAgICAgICAgeyBjbGFzc05hbWU6IFwiY29sIG02IG0tb2Zmc2V0MSBzMTIgcHJldmlld1wiIH0sXG4gICAgICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgICAgICAgIFwiaDJcIixcbiAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFxuICAgICAgICAgICAgICBcInNwYW5cIixcbiAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgICAgXCJQcmV2aWV3XCJcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBsb2FkaW5nQW5pbVxuICAgICAgICAgICksXG4gICAgICAgICAgUmVuZGVyVXRpbHMuYnVpbGRFcnJvcih0aGlzLnN0YXRlLmVycm9yKSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIiwgeyB0eXBlOiBcInRleHRcIiwgcmVhZG9ubHk6IHRydWUsIHZhbHVlOiB0aGlzLnN0YXRlLnN1YmplY3RQcmV2aWV3LCBwbGFjZWhvbGRlcjogXCJTdWJqZWN0IHByZXZpZXcuLi5cIiB9KSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KFwiZGl2XCIsIHsgY2xhc3NOYW1lOiBcImJvZHlcIixcbiAgICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MOiB7IF9faHRtbDogdGhpcy5zdGF0ZS5ib2R5UHJldmlldyB9IH0pXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICB0aGlzLl9idWlsZFNlbmRCdXR0b24oKVxuICAgICk7XG4gIH0sXG5cbiAgX2J1aWxkU2VuZEJ1dHRvbjogZnVuY3Rpb24gX2J1aWxkU2VuZEJ1dHRvbigpIHtcbiAgICB2YXIgbnVtVXNlcnMgPSB0aGlzLnByb3BzLnVzZXJzLmxlbmd0aDtcblxuICAgIHZhciBzZW5kQnV0dG9uID0gbnVsbCxcbiAgICAgICAgc2VuZEFuaW0gPSBudWxsLFxuICAgICAgICBzZW5kQnRuTGFiZWwgPSBcIlNlbmQgdG8gXCIgKyBudW1Vc2VycyArIFwiIFwiICsgKDEgPT0gbnVtVXNlcnMgPyBcInVzZXJcIiA6IFwidXNlcnNcIik7XG5cbiAgICBpZiAodGhpcy5zdGF0ZS5zZW5kaW5nKSB7XG4gICAgICBzZW5kQnV0dG9uID0gUmVhY3QuY3JlYXRlRWxlbWVudChCdXR0b24sIHsgbGFiZWw6IHNlbmRCdG5MYWJlbCwgZGlzYWJsZWQ6IHRydWUgfSk7XG4gICAgICBzZW5kQW5pbSA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoTG9hZGVyLCB7IGlubGluZTogdHJ1ZSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VuZEJ1dHRvbiA9IFJlYWN0LmNyZWF0ZUVsZW1lbnQoQnV0dG9uLCB7IGxhYmVsOiBzZW5kQnRuTGFiZWwsIG9uQ2xpY2s6IHRoaXMuX29uU2VuZCB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudChcbiAgICAgIFwiZGl2XCIsXG4gICAgICB7IGNsYXNzTmFtZTogXCJzZW5kLWluZm9cIiB9LFxuICAgICAgc2VuZEJ1dHRvbixcbiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoXG4gICAgICAgIFwiZGl2XCIsXG4gICAgICAgIHsgY2xhc3NOYW1lOiBcInNlbmQtcmVzdWx0XCIgfSxcbiAgICAgICAgc2VuZEFuaW0sXG4gICAgICAgIFJlbmRlclV0aWxzLmJ1aWxkRXJyb3IodGhpcy5zdGF0ZS5zZW5kRXJyb3IpXG4gICAgICApXG4gICAgKTtcbiAgfSxcblxuICBfb25TdWJqZWN0Q2hhbmdlOiBmdW5jdGlvbiBfb25TdWJqZWN0Q2hhbmdlKGUpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHN1YmplY3Q6IGUuY3VycmVudFRhcmdldC52YWx1ZVxuICAgIH0pO1xuXG4gICAgdGhpcy5fZmV0Y2hQcmV2aWV3KCk7XG4gIH0sXG5cbiAgX29uQm9keUNoYW5nZTogZnVuY3Rpb24gX29uQm9keUNoYW5nZSh0ZXh0KSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBib2R5OiB0ZXh0XG4gICAgfSk7XG5cbiAgICB0aGlzLl9mZXRjaFByZXZpZXcoKTtcbiAgfSxcblxuICBfZmV0Y2hQcmV2aWV3OiBmdW5jdGlvbiBfZmV0Y2hQcmV2aWV3KCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIGlmIG5vdCB1c2VycyBkb24ndCBmZXRjaFxuICAgIGlmICghdGhpcy5wcm9wcy51c2Vycy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBnaXZlIHRpbWUgZm9yIG11bHRpcGxlIHN1Y2Nlc3NpdmUgdGVtcGxhdGUgY2hhbmdlcyB0byB0YWtlIHBsYWNlXG4gICAgaWYgKHNlbGYuX2ZldGNoUHJldmlld1RpbWVyKSB7XG4gICAgICBzZWxmLl9mZXRjaFByZXZpZXdUaW1lci5zdG9wKCk7XG4gICAgfVxuXG4gICAgc2VsZi5fZmV0Y2hQcmV2aWV3VGltZXIgPSBUaW1lcihmdW5jdGlvbiAoKSB7XG5cbiAgICAgIHNlbGYuc2V0U3RhdGUoe1xuICAgICAgICBsb2FkaW5nOiB0cnVlLFxuICAgICAgICBlcnJvcjogbnVsbCB9KTtcblxuICAgICAgLy8gZmV0Y2ggY29sbGVjdGlvbiByb3dzXG4gICAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6IFwiL2FkbWluL2VtYWlscy9yZW5kZXI/Zm9ybWF0PWpzb25cIixcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHN1YmplY3Q6IHNlbGYuc3RhdGUuc3ViamVjdCxcbiAgICAgICAgICBib2R5OiBzZWxmLnN0YXRlLmJvZHksXG4gICAgICAgICAgdXNlcjogc2VsZi5wcm9wcy51c2Vyc1swXS5faWRcbiAgICAgICAgfVxuICAgICAgfSkuZG9uZShmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBzZWxmLnNldFN0YXRlSWZNb3VudGVkKHtcbiAgICAgICAgICBzdWJqZWN0UHJldmlldzogZGF0YS5zdWJqZWN0IHx8IFwiXCIsXG4gICAgICAgICAgYm9keVByZXZpZXc6IGRhdGEuYm9keSB8fCBcIlwiIH0pO1xuICAgICAgfSkuZmFpbChmdW5jdGlvbiAoeGhyKSB7XG4gICAgICAgIHNlbGYuc2V0U3RhdGVJZk1vdW50ZWQoe1xuICAgICAgICAgIGVycm9yOiB4aHJcbiAgICAgICAgfSk7XG4gICAgICB9KS5hbHdheXMoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLnNldFN0YXRlSWZNb3VudGVkKHtcbiAgICAgICAgICBsb2FkaW5nOiBmYWxzZSB9KTtcbiAgICAgIH0pO1xuICAgIH0sIDMwMCkuc3RhcnQoKTtcbiAgfSxcblxuICBfb25TZW5kOiBmdW5jdGlvbiBfb25TZW5kKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIC8vIGlmIG5vdCB1c2VycyBkb24ndCBmZXRjaFxuICAgIGlmICghdGhpcy5wcm9wcy51c2Vycy5sZW5ndGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHNlbmRpbmc6IHRydWUsXG4gICAgICBzZW5kRXJyb3I6IG51bGwgfSk7XG5cbiAgICAvLyBmZXRjaCBjb2xsZWN0aW9uIHJvd3NcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiBcIi9hZG1pbi9lbWFpbHMvc2VuZD9mb3JtYXQ9anNvblwiLFxuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3ViamVjdDogc2VsZi5zdGF0ZS5zdWJqZWN0LFxuICAgICAgICBib2R5OiBzZWxmLnN0YXRlLmJvZHksXG4gICAgICAgIHVzZXJzOiBzZWxmLnByb3BzLnVzZXJzLm1hcChmdW5jdGlvbiAodikge1xuICAgICAgICAgIHJldHVybiB2Ll9pZDtcbiAgICAgICAgfSkgfVxuICAgIH0pLmRvbmUoZnVuY3Rpb24gKCkge1xuICAgICAgTWF0ZXJpYWxpemUudG9hc3QoXCJFbWFpbCBzdWNjZXNmdWxseSBzZW50XCIsIDIwMDAsIFwicm91bmRlZFwiKTtcblxuICAgICAgLy8gY2xlYXIgaW5wdXRzXG4gICAgICBzZWxmLnJlZnMuYm9keS5jbGVhcigpO1xuICAgICAgUmVhY3QuZmluZERPTU5vZGUoc2VsZi5yZWZzLnN1YmplY3QpLnZhbHVlID0gXCJcIjtcblxuICAgICAgc2VsZi5zZXRTdGF0ZUlmTW91bnRlZCh7XG4gICAgICAgIHN1YmplY3Q6IFwiXCIsXG4gICAgICAgIGJvZHk6IFwiXCIsXG4gICAgICAgIHN1YmplY3RQcmV2aWV3OiBcIlwiLFxuICAgICAgICBib2R5UHJldmlldzogXCJcIiB9KTtcbiAgICB9KS5mYWlsKGZ1bmN0aW9uICh4aHIpIHtcbiAgICAgIHNlbGYuc2V0U3RhdGVJZk1vdW50ZWQoe1xuICAgICAgICBzZW5kRXJyb3I6IHhoclxuICAgICAgfSk7XG4gICAgfSkuYWx3YXlzKGZ1bmN0aW9uICgpIHtcbiAgICAgIHNlbGYuc2V0U3RhdGVJZk1vdW50ZWQoe1xuICAgICAgICBzZW5kaW5nOiBmYWxzZSB9KTtcbiAgICB9KTtcbiAgfSB9KTtcblxuXG4vKiogV0VCUEFDSyBGT09URVIgKipcbiAqKiAvVXNlcnMvcmFtL2Rldi9qcy93YWlnby1mcmFtZXdvcmsvd2FpZ28vfi9iYWJlbC1sb2FkZXI/ZXhwZXJpbWVudGFsJm9wdGlvbmFsPXJ1bnRpbWUhLi9wYWdlcy9lbWFpbHMvc2VuZC5qc1xuICoqLyJdLCJzb3VyY2VSb290IjoiIn0=